<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªãƒ”è²·ã„ç®¡ç† - Amazonåœ¨åº«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#232F3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .amazon-orange { background-color: #FF9900; }
        .amazon-dark { background-color: #232F3E; }
        .keepa-blue { color: #004B91; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-10">

    <header class="amazon-dark text-white p-4 sticky top-0 z-50 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ğŸ›’ ãƒªãƒ”è²·ã„ç®¡ç†</h1>
            <input type="text" id="assocId" value="your-tag-22" class="bg-gray-700 text-[10px] px-2 py-1 rounded w-20 outline-none focus:ring-1 focus:ring-orange-400">
        </div>
    </header>

    <main class="container mx-auto p-4 max-w-lg">
        <div class="bg-white p-5 rounded-2xl shadow-sm mb-6 border border-gray-200">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-sm font-bold text-gray-700">æ–°ã—ã„å•†å“ã‚’ç™»éŒ²</h2>
                <button onclick="searchAmazon()" class="text-xs text-blue-600 font-semibold underline">Amazonã§æ¤œç´¢ã—ã¦æ¢ã™</button>
            </div>
            <div class="space-y-3">
                <input type="text" id="itemName" placeholder="å•†å“åï¼ˆä¾‹ï¼šå¼·ç‚­é…¸æ°´ï¼‰" class="w-full border p-3 rounded-xl text-sm focus:border-orange-400 outline-none">
                <input type="text" id="asin" placeholder="URLã¾ãŸã¯ASINã‚’è²¼ã‚Šä»˜ã‘" class="w-full border p-3 rounded-xl text-sm focus:border-orange-400 outline-none">
                <textarea id="itemMemo" placeholder="è‡ªåˆ†ç”¨ãƒ¡ãƒ¢ï¼ˆä¾‹ï¼š1,200å††ä»¥ä¸‹ã®æ™‚ã«è²·ã†ï¼‰" class="w-full border p-3 rounded-xl text-sm focus:border-orange-400 outline-none h-20"></textarea>
                <button onclick="addItem()" class="w-full amazon-orange text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
            </div>
        </div>

        <div id="saleBanner" class="hidden bg-red-100 border border-red-200 p-3 rounded-xl mb-6 text-red-700 text-sm font-bold text-center animate-pulse">
            ğŸ”¥ ç¾åœ¨Amazonãƒ“ãƒƒã‚°ã‚»ãƒ¼ãƒ«é–‹å‚¬ä¸­ï¼
        </div>

        <div id="itemList" class="grid gap-4 grid-cols-1">
            </div>
    </main>

    <script>
        let items = JSON.parse(localStorage.getItem('amazonStocks')) || [];
        
        function searchAmazon() {
            const query = document.getElementById('itemName').value || "";
            window.open(`https://www.amazon.co.jp/s?k=${encodeURIComponent(query)}`, '_blank');
        }

        function addItem() {
            const name = document.getElementById('itemName').value;
            const rawAsin = document.getElementById('asin').value;
            const memo = document.getElementById('itemMemo').value;
            const asin = extractASIN(rawAsin);

            if (!name || !asin) return alert('å•†å“åã¨ASINã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            items.push({
                id: Date.now(),
                name: name,
                asin: asin,
                memo: memo,
                lastBought: new Date().toLocaleDateString()
            });
            save();
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
            document.getElementById('itemName').value = '';
            document.getElementById('asin').value = '';
            document.getElementById('itemMemo').value = '';
        }

        function extractASIN(input) {
            const match = input.match(/\/(?:dp|gp\/product)\/([A-Z0-9]{10})/);
            return match ? match[1] : input.trim().toUpperCase();
        }

        function save() {
            localStorage.setItem('amazonStocks', JSON.stringify(items));
            render();
        }

        function deleteItem(id) {
            if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                items = items.filter(i => i.id !== id);
                save();
            }
        }

        function render() {
            const list = document.getElementById('itemList');
            const tag = document.getElementById('assocId').value || 'your-tag-22';
            list.innerHTML = '';

            items.forEach(item => {
                const amazonUrl = `https://www.amazon.co.jp/dp/${item.asin}/?tag=${tag}`;
                const keepaUrl = `https://keepa.com/#!product/1-${item.asin}`;
                
                const card = document.createElement('div');
                card.className = 'bg-white p-5 rounded-2xl shadow-sm border border-gray-100';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg text-gray-800">${item.name}</h3>
                        <button onclick="deleteItem(${item.id})" class="text-gray-300 text-xl">Ã—</button>
                    </div>
                    ${item.memo ? `<p class="text-xs text-orange-600 bg-orange-50 p-2 rounded-lg mb-4">ğŸ“ ${item.memo}</p>` : ''}
                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <a href="${keepaUrl}" target="_blank" class="text-center border border-gray-200 py-2 rounded-xl text-[10px] font-bold text-gray-500 hover:bg-gray-50">
                            ğŸ“Š ä¾¡æ ¼æ¨ç§»ã‚’ç¢ºèª
                        </a>
                        <a href="${amazonUrl}" target="_blank" class="text-center amazon-orange text-white py-2 rounded-xl text-sm font-bold shadow-sm">
                            å†æ³¨æ–‡ã™ã‚‹
                        </a>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        // ã‚»ãƒ¼ãƒ«æœŸé–“åˆ¤å®šï¼ˆä¾‹: ãƒ–ãƒ©ãƒƒã‚¯ãƒ•ãƒ©ã‚¤ãƒ‡ãƒ¼ç­‰ã®æœŸé–“ã«trueã«ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
        const isSale = false; // ã“ã“ã‚’å°†æ¥çš„ã«APIç­‰ã§è‡ªå‹•åŒ–å¯èƒ½
        if(isSale) document.getElementById('saleBanner').classList.remove('hidden');

        render();
    </script>
</body>
</html>

